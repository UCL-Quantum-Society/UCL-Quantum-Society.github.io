---
export const prerender = true;
---

<div class="relative min-h-screen flex items-center">
  <div aria-hidden="true" class="absolute inset-0 grid grid-cols-2 -space-x-52 opacity-40"></div>
  <div class="relative w-full">
    <div class="lg:w-2/3 text-center mx-auto">
      <h1 id="hero-target" class="text-white text-balance font-medium text-5xl md:text-6xl xl:text-7xl">
        <span id="hero-before" class="font-medium text-white" style="-webkit-text-stroke: 2px #1e293b; color: white;"
        ></span>
        <span id="hero-after" class="text-primary font-semibold"></span>
      </h1>
      <div class="m-12 flex flex-wrap justify-center gap-y-4 gap-x-6 fade-on-ready" aria-hidden="true">
        <a
          href="https://studentsunionucl.org/clubs-societies/quantum-society"
          target="_blank"
          rel="noopener noreferrer"
          class="relative flex h-11 w-full items-center justify-center px-6 rounded-full border border-primary/30 bg-[var(--color-primary)] hover:bg-[color-mix(in srgb, var(--color-primary) 80%, white)] text-white transition-all duration-300 transform hover:scale-105 sm:w-max"
        >
          <span class="relative text-base font-medium">Become a Member</span>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Spacer to separate hero from footer -->
<div class="hero-spacer" aria-hidden="true"></div>

<style>
  .hero-spacer {
    height: 1rem;
  }
  @media (min-width: 768px) {
    .hero-spacer {
      height: 2rem;
    }
  }
  @media (min-width: 1280px) {
    .hero-spacer {
      height: 3rem;
    }
  }
</style>

<script>
  (() => {
    const heroBefore = document.getElementById('hero-before');
    const heroAfter = document.getElementById('hero-after');
    const heroTarget = document.getElementById('hero-target');
    const restFadeEls = Array.from(document.querySelectorAll('.fade-on-ready'));

    if (!heroBefore || !heroAfter || !heroTarget) return;

    const fullText = 'The future is Quantum.';
    const splitIndex = 'The future is '.length;
    const typingSpeed = 65; // slightly faster typing for a snappier effect
    let i = 0;

    // Do not copy computed font styles to inline styles â€” allow CSS (Tailwind responsive classes)
    // to control font size and wrapping so the typing animation follows the responsive layout.

    function revealRest() {
      // increase stagger to 600ms per element for a much slower, deliberate reveal
      restFadeEls.forEach((el, idx) => {
        setTimeout(
          () => {
            el.classList.add('show');
            // make element available to assistive tech
            el.removeAttribute('aria-hidden');
            // after revealing the very first element, focus the first interactive child if any
            if (idx === 0) {
              const firstFocusable = el.querySelector('a, button, input, [tabindex]:not([tabindex="-1"])');
              if (firstFocusable instanceof HTMLElement) {
                // focus shortly after it becomes visible; match the slower reveals
                setTimeout(() => firstFocusable.focus(), 420 + idx * 120);
              }
            }
          },
          600 * idx + 40
        );
      });
    }

    // Respect user's reduced motion preference: skip typing and show content immediately
    const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReduced) {
      heroBefore.textContent = 'The future is ';
      heroAfter.textContent = 'Quantum.';
      restFadeEls.forEach((el) => {
        el.classList.add('show');
        el.removeAttribute('aria-hidden');
      });
      // make hero spans visible immediately as well
      heroBefore.style.opacity = '1';
      heroAfter.style.opacity = '1';
      return;
    }

    function typeNext() {
      if (i <= fullText.length) {
        const beforeText = fullText.slice(0, Math.min(i, splitIndex));
        const afterText = i > splitIndex ? fullText.slice(splitIndex, i) : '';
        heroBefore.textContent = beforeText;
        heroAfter.textContent = afterText;
        i++;
        setTimeout(typeNext, typingSpeed);
      } else {
        // ensure final text
        heroBefore.textContent = 'The future is ';
        heroAfter.textContent = 'Quantum.';
        // reveal remaining hero content
        revealRest();
      }
    }

    // Make spans visible then start typing after a small delay to avoid flash
    function startTyping() {
      heroBefore.style.opacity = '1';
      heroAfter.style.opacity = '1';
      // start typing after spans begin to fade in so the typed characters appear after the fade starts
      setTimeout(typeNext, 900);
    }
    requestAnimationFrame(startTyping);
  })();
</script>
